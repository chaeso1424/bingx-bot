<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <title>로그 보기</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    body { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; margin: 0; background:#0b0f14; color:#cdd9e5; }
    .topbar { display:flex; justify-content:space-between; align-items:center; background:#111921; color:#e6edf3; padding:12px 16px; position:sticky; top:0; z-index:10; }
    .btn { background:#2b6cb0; color:#fff; border:0; padding:8px 12px; border-radius:6px; text-decoration:none; cursor:pointer; }
    .btn:hover { filter:brightness(1.05); }
    .wrap { padding:12px 16px; }
    #logbox { white-space:pre-wrap; background:#0e1621; border:1px solid #1f2a37; border-radius:8px; padding:12px; line-height:1.4; height:70vh; overflow:auto; }
    .muted { color:#9aa7b2; font-size:12px; }
    .toolbar { display:flex; gap:8px; align-items:center; margin:10px 0; }
  </style>
</head>
<body>
  <header class="topbar">
    <div>📜 실시간 로그</div>
    <div>
      <a href="/" class="btn">← 대시보드</a>
    </div>
  </header>

  <div class="wrap">
    <div class="toolbar">
      <button id="pause" class="btn" data-paused="false">⏸ 일시정지</button>
      <button id="clear" class="btn">🧹 지우기</button>
      <span class="muted">자동 갱신 • 마지막 300줄부터 표시</span>
    </div>
    <pre id="logbox"></pre>
  </div>

  <script>
    const logbox   = document.getElementById('logbox');   // <pre id="logbox"></pre>
    const btnPause = document.getElementById('pause');    // (있으면) 일시정지 버튼
    const btnClear = document.getElementById('clear');    // (있으면) 지우기 버튼

    // 사용자가 맨 아래를 보고 있는지 확인
    function atBottom() {
      return (logbox.scrollTop + logbox.clientHeight) >= (logbox.scrollHeight - 4);
    }

    async function refreshLogs() {
      try {
        if (btnPause && btnPause.dataset.paused === 'true') return;

        const res  = await fetch('/logs/text?tail=500&ts=' + Date.now(), { cache: 'no-store' });
        const text = await res.text();

        const wasBottom = atBottom();
        logbox.textContent = text;
        if (wasBottom) {
          logbox.scrollTop = logbox.scrollHeight;
        }
      } catch (e) {
        // 조용히 무시 → 다음 틱에 재시도
      }
    }

    // 1.5초 간격으로 업데이트(원하면 800~2000ms로 조정)
    const intervalMs = 1500;
    setInterval(refreshLogs, intervalMs);
    // 최초 1회
    refreshLogs();

    // 선택) 일시정지/지우기 버튼 연결
    if (btnPause) {
      btnPause.addEventListener('click', () => {
        const paused = btnPause.dataset.paused === 'true';
        btnPause.dataset.paused = String(!paused);
        btnPause.textContent = paused ? '⏸ 일시정지' : '▶ 다시보기';
      });
    }
    if (btnClear) {
      btnClear.addEventListener('click', () => { logbox.textContent = ''; });
    }
  </script>
</body>
</html>
