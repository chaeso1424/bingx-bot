<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <title>ë¡œê·¸ ë³´ê¸°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    body { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; margin: 0; background:#0b0f14; color:#cdd9e5; }
    .topbar { display:flex; justify-content:space-between; align-items:center; background:#111921; color:#e6edf3; padding:12px 16px; position:sticky; top:0; z-index:10; }
    .btn { background:#2b6cb0; color:#fff; border:0; padding:8px 12px; border-radius:6px; text-decoration:none; cursor:pointer; }
    .btn:hover { filter:brightness(1.05); }
    .wrap { padding:12px 16px; }
    #logbox { white-space:pre-wrap; background:#0e1621; border:1px solid #1f2a37; border-radius:8px; padding:12px; line-height:1.4; height:70vh; overflow:auto; }
    .muted { color:#9aa7b2; font-size:12px; }
    .toolbar { display:flex; gap:8px; align-items:center; margin:10px 0; }
  </style>
</head>
<body>
  <header class="topbar">
    <div>ğŸ“œ ì‹¤ì‹œê°„ ë¡œê·¸</div>
    <div>
      <a href="/" class="btn">â† ëŒ€ì‹œë³´ë“œ</a>
    </div>
  </header>

  <div class="wrap">
    <div class="toolbar">
      <button id="pause" class="btn" data-paused="false">â¸ ì¼ì‹œì •ì§€</button>
      <button id="clear" class="btn">ğŸ§¹ ì§€ìš°ê¸°</button>
      <span class="muted">ìë™ ê°±ì‹  â€¢ ë§ˆì§€ë§‰ 300ì¤„ë¶€í„° í‘œì‹œ</span>
    </div>
    <pre id="logbox"></pre>
  </div>

  <script>
    const logbox = document.getElementById('logbox');
    const btnPause = document.getElementById('pause');
    const btnClear = document.getElementById('clear');

    // ë„ˆë¬´ ê¸¸ì–´ì§€ì§€ ì•Šê²Œ ë¸Œë¼ìš°ì € ë©”ëª¨ë¦¬ ë³´í˜¸
    const MAX_LINES = 2000;

    // ìë™ ìŠ¤í¬ë¡¤(ì‚¬ìš©ìê°€ ë§¨ ì•„ë˜ ë³´ê³  ìˆì„ ë•Œë§Œ)
    function isAtBottom() {
      return (logbox.scrollTop + logbox.clientHeight) >= (logbox.scrollHeight - 4);
    }
    function appendLine(text) {
      const atBottom = isAtBottom();
      logbox.textContent += (logbox.textContent ? '\n' : '') + text;
      // ì˜¤ë˜ëœ ë¼ì¸ ì œê±°
      const lines = logbox.textContent.split('\n');
      if (lines.length > MAX_LINES) {
        logbox.textContent = lines.slice(-MAX_LINES).join('\n');
      }
      if (atBottom) {
        logbox.scrollTop = logbox.scrollHeight;
      }
    }

    // SSE êµ¬ë…
    let es = null;
    function connect() {
      if (es) es.close();
      // tail=300 ì¤„ë¶€í„°, interval=0.8ì´ˆ í´ë§
      es = new EventSource('/logs/stream?tail=300&interval=0.8');
      es.onmessage = (e) => {
        if (btnPause.dataset.paused === 'true') return;
        appendLine(e.data);
      };
      es.onerror = () => {
        // ì ê¹ ëŠê¸°ë©´ ì¬ì—°ê²° ì‹œë„
        if (es) es.close();
        setTimeout(connect, 1500);
      };
    }
    connect();

    // ë²„íŠ¼ ë™ì‘
    btnPause.addEventListener('click', () => {
      const paused = btnPause.dataset.paused === 'true';
      btnPause.dataset.paused = String(!paused);
      btnPause.textContent = paused ? 'â¸ ì¼ì‹œì •ì§€' : 'â–¶ ë‹¤ì‹œë³´ê¸°';
    });
    btnClear.addEventListener('click', () => {
      logbox.textContent = '';
    });

    // í˜ì´ì§€ ë– ë‚˜ë©´ ì—°ê²° ë‹«ê¸°
    window.addEventListener('beforeunload', () => { if (es) es.close(); });
  </script>
</body>
</html>
