<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <title>ë¡œê·¸ ë³´ê¸°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    body { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; margin: 0; background:#0b0f14; color:#cdd9e5; }
    .topbar { display:flex; justify-content:space-between; align-items:center; background:#111921; color:#e6edf3; padding:12px 16px; position:sticky; top:0; z-index:10; }
    .btn { background:#2b6cb0; color:#fff; border:0; padding:8px 12px; border-radius:6px; text-decoration:none; cursor:pointer; }
    .btn:hover { filter:brightness(1.05); }
    .wrap { padding:12px 16px; }
    #logbox { white-space:pre-wrap; background:#0e1621; border:1px solid #1f2a37; border-radius:8px; padding:12px; line-height:1.4; height:70vh; overflow:auto; }
    .muted { color:#9aa7b2; font-size:12px; }
    .toolbar { display:flex; gap:8px; align-items:center; margin:10px 0; }
  </style>
</head>
<body>
  <header class="topbar">
    <div>ğŸ“œ ì‹¤ì‹œê°„ ë¡œê·¸</div>
    <div>
      <a href="/" class="btn">â† ëŒ€ì‹œë³´ë“œ</a>
    </div>
  </header>

  <div class="wrap">
    <div class="toolbar">
      <button id="pause" class="btn" data-paused="false">â¸ ì¼ì‹œì •ì§€</button>
      <button id="clear" class="btn">ğŸ§¹ ì§€ìš°ê¸°</button>
      <span class="muted">ìë™ ê°±ì‹  â€¢ ë§ˆì§€ë§‰ 300ì¤„ë¶€í„° í‘œì‹œ</span>
    </div>
    <pre id="logbox"></pre>
  </div>

  <script>
    const logbox   = document.getElementById('logbox');   // <pre id="logbox"></pre>
    const btnPause = document.getElementById('pause');    // (ìˆìœ¼ë©´) ì¼ì‹œì •ì§€ ë²„íŠ¼
    const btnClear = document.getElementById('clear');    // (ìˆìœ¼ë©´) ì§€ìš°ê¸° ë²„íŠ¼

    // ì‚¬ìš©ìê°€ ë§¨ ì•„ë˜ë¥¼ ë³´ê³  ìˆëŠ”ì§€ í™•ì¸
    function atBottom() {
      return (logbox.scrollTop + logbox.clientHeight) >= (logbox.scrollHeight - 4);
    }

    async function refreshLogs() {
      try {
        if (btnPause && btnPause.dataset.paused === 'true') return;

        const res  = await fetch('/logs/text?tail=500&ts=' + Date.now(), { cache: 'no-store' });
        const text = await res.text();

        const wasBottom = atBottom();
        logbox.textContent = text;
        if (wasBottom) {
          logbox.scrollTop = logbox.scrollHeight;
        }
      } catch (e) {
        // ì¡°ìš©íˆ ë¬´ì‹œ â†’ ë‹¤ìŒ í‹±ì— ì¬ì‹œë„
      }
    }

    // 1.5ì´ˆ ê°„ê²©ìœ¼ë¡œ ì—…ë°ì´íŠ¸(ì›í•˜ë©´ 800~2000msë¡œ ì¡°ì •)
    const intervalMs = 1500;
    setInterval(refreshLogs, intervalMs);
    // ìµœì´ˆ 1íšŒ
    refreshLogs();

    // ì„ íƒ) ì¼ì‹œì •ì§€/ì§€ìš°ê¸° ë²„íŠ¼ ì—°ê²°
    if (btnPause) {
      btnPause.addEventListener('click', () => {
        const paused = btnPause.dataset.paused === 'true';
        btnPause.dataset.paused = String(!paused);
        btnPause.textContent = paused ? 'â¸ ì¼ì‹œì •ì§€' : 'â–¶ ë‹¤ì‹œë³´ê¸°';
      });
    }
    if (btnClear) {
      btnClear.addEventListener('click', () => { logbox.textContent = ''; });
    }
  </script>
</body>
</html>
